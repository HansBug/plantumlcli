language: python
python:
  - '3.5'
  - '3.6'
  - '3.7'
  - '3.8'
  - '3.9'
  - 'pypy3.5'
  - 'pypy3.6-7.0.0'
sudo: required
env:
  global:
    - secure: AhC5MX7sjEmpqcWMDDaX2EordNTYwAVRf7Y8NhatwMrIvA7JcdUZTM1Ix5FB89pXhrhqodG8Vp/SpF96hzno6kf6GfQME27Kf2Wwjfg68q2t88xBoH1735VmT7GOAUFs43hoXzAaOxnztRdQvfB5uQ/4QW5vHZzLIgknvB8ZuLdAGcabI/aWpeKxtoNyTi9RVLdPwfcXuef8z3PsiSowtYHNilpUXnfUcWsV8saCkX4GKCiBMrNqCl8LwTlTpOjoaaaVbsOirlJq4uJASIlcwITGrxfZPOROfjbP2fYt2eaSaV/yHXw5QGeQzEnzIEiAwE8ffFfQ9j8Z67bk+9liPq4GvEPR4DmLmlphELh75pYKa69feE3LeW9GX82QavHsSAqqW/lvT77EmFojUXMwv7wRk62nwFf1eZns3oxhEBNvYt8GaPEEuwVuk5v5k3itgPzt+W5dnE4OqaduBHmxl6XqRBiBpFh4jN1rX24sPtRckonWV9MsSfgP4k2rECDUd7GhlddmZmYND7GDBydJDdHSLlcxMWrDKasGAiez9r6qru4ZQFUdOVX9uuFt/RSHbaFMVk0Aosk5ekwMQU0+jzCHlcJ1vKWRBCwJ7wQfZZ4BCmgFANpW8zJKOhSwYqyQ5PUXvManUfNAmVFJSdfoCm4FwEWO0i217+s/r7K+l3A=
    - PRIMARY_JAR_VERSION=1.2020.19
  jobs:
    - ASSISTANT_JAR_VERSION=1.2019.13
    - ASSISTANT_JAR_VERSION=1.2018.14
    - ASSISTANT_JAR_VERSION=1.2017.20
install:
  - sudo apt-get update
  - sudo apt-get install -y curl wget make tree cloc
  - sudo apt-get install -y openjdk-8-jdk
    && java -version && javac -version
  - sudo apt-get install -y graphviz
    && sudo dot -c
  - curl -o get-pip.py 'https://bootstrap.pypa.io/get-pip.py'
    && python get-pip.py
    && pip install -U pip
    && pip install -r requirements.txt
    && pip install -r requirements-test.txt
    && python -V && pip --version && pytest --version
  - source env.sh
    && java -jar "${PRIMARY_JAR_PATH}" -version
    && java -jar "${ASSISTANT_JAR_PATH}" -version
  - tree ${DEMO_PATH}
  - cloc plantumlcli && cloc test
script:
  - pytest ./test --cov-report term-missing --cov=./plantumlcli -sv -m unittest --durations=10
  - pytest ./test -sv -m benchmark --durations=0
after_success:
  - pip install -U coveralls[yaml]
  - coveralls
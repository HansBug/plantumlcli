import hashlib
import os.path

import pytest

from plantumlcli.download import get_plantuml_jar_url, get_plantuml_jar_file


def _get_file_sha256(filename: str) -> str:
    sha256_hash = hashlib.sha256()
    with open(filename, "rb") as f:
        while True:
            data = f.read(1 << 20)
            if not data:
                break
            sha256_hash.update(data)
    return sha256_hash.hexdigest()


@pytest.mark.unittest
class TestDownloadBase:
    @pytest.mark.parametrize(['version', 'expected_url'], [
        ('1.2017.12', 'https://sourceforge.net/projects/plantuml/files/1.2017.12/plantuml.1.2017.12.jar/download'),
        ('1.2017.13', 'https://sourceforge.net/projects/plantuml/files/1.2017.13/plantuml.1.2017.13.jar/download'),
        ('1.2017.14', 'https://sourceforge.net/projects/plantuml/files/1.2017.14/plantuml.1.2017.14.jar/download'),
        ('1.2017.15', 'https://sourceforge.net/projects/plantuml/files/1.2017.15/plantuml.1.2017.15.jar/download'),
        ('1.2017.16', 'https://sourceforge.net/projects/plantuml/files/1.2017.16/plantuml.1.2017.16.jar/download'),
        ('1.2017.18', 'https://sourceforge.net/projects/plantuml/files/1.2017.18/plantuml.1.2017.18.jar/download'),
        ('1.2017.19', 'https://sourceforge.net/projects/plantuml/files/1.2017.19/plantuml.1.2017.19.jar/download'),
        ('1.2017.20', 'https://sourceforge.net/projects/plantuml/files/1.2017.20/plantuml.1.2017.20.jar/download'),
        ('1.2018.0', 'https://sourceforge.net/projects/plantuml/files/1.2018.0/plantuml.1.2018.0.jar/download'),
        ('1.2018.1', 'https://sourceforge.net/projects/plantuml/files/1.2018.1/plantuml.1.2018.1.jar/download'),
        ('1.2018.2', 'https://sourceforge.net/projects/plantuml/files/1.2018.2/plantuml.1.2018.2.jar/download'),
        ('1.2018.3', 'https://sourceforge.net/projects/plantuml/files/1.2018.3/plantuml.1.2018.3.jar/download'),
        ('1.2018.4', 'https://sourceforge.net/projects/plantuml/files/1.2018.4/plantuml.1.2018.4.jar/download'),
        ('1.2018.5', 'https://sourceforge.net/projects/plantuml/files/1.2018.5/plantuml.1.2018.5.jar/download'),
        ('1.2018.6', 'https://sourceforge.net/projects/plantuml/files/1.2018.6/plantuml.1.2018.6.jar/download'),
        ('1.2018.7', 'https://sourceforge.net/projects/plantuml/files/1.2018.7/plantuml.1.2018.7.jar/download'),
        ('1.2018.8', 'https://sourceforge.net/projects/plantuml/files/1.2018.8/plantuml.1.2018.8.jar/download'),
        ('1.2018.9', 'https://sourceforge.net/projects/plantuml/files/1.2018.9/plantuml.1.2018.9.jar/download'),
        ('1.2018.10', 'https://sourceforge.net/projects/plantuml/files/1.2018.10/plantuml.1.2018.10.jar/download'),
        ('1.2018.11', 'https://sourceforge.net/projects/plantuml/files/1.2018.11/plantuml.1.2018.11.jar/download'),
        ('1.2018.12', 'https://sourceforge.net/projects/plantuml/files/1.2018.12/plantuml.1.2018.12.jar/download'),
        ('1.2018.13', 'https://sourceforge.net/projects/plantuml/files/1.2018.13/plantuml.1.2018.13.jar/download'),
        ('1.2018.14', 'https://sourceforge.net/projects/plantuml/files/1.2018.14/plantuml.1.2018.14.jar/download'),
        ('1.2019.0', 'https://sourceforge.net/projects/plantuml/files/1.2019.0/plantuml.1.2019.0.jar/download'),
        ('1.2019.1', 'https://sourceforge.net/projects/plantuml/files/1.2019.1/plantuml.1.2019.1.jar/download'),
        ('1.2019.2', 'https://sourceforge.net/projects/plantuml/files/1.2019.2/plantuml.1.2019.2.jar/download'),
        ('1.2019.3', 'https://sourceforge.net/projects/plantuml/files/1.2019.3/plantuml.1.2019.3.jar/download'),
        ('1.2019.4', 'https://sourceforge.net/projects/plantuml/files/1.2019.4/plantuml.1.2019.4.jar/download'),
        ('1.2019.5', 'https://sourceforge.net/projects/plantuml/files/1.2019.5/plantuml.1.2019.5.jar/download'),
        ('1.2019.6', 'https://sourceforge.net/projects/plantuml/files/1.2019.6/plantuml.1.2019.6.jar/download'),
        ('1.2019.7', 'https://sourceforge.net/projects/plantuml/files/1.2019.7/plantuml.1.2019.7.jar/download'),
        ('1.2019.8', 'https://sourceforge.net/projects/plantuml/files/1.2019.8/plantuml.1.2019.8.jar/download'),
        ('1.2019.9', 'https://sourceforge.net/projects/plantuml/files/1.2019.9/plantuml.1.2019.9.jar/download'),
        ('1.2019.10', 'https://sourceforge.net/projects/plantuml/files/1.2019.10/plantuml.1.2019.10.jar/download'),
        ('1.2019.11', 'https://sourceforge.net/projects/plantuml/files/1.2019.11/plantuml.1.2019.11.jar/download'),
        ('1.2019.12', 'https://sourceforge.net/projects/plantuml/files/1.2019.12/plantuml.1.2019.12.jar/download'),
        ('1.2019.13', 'https://sourceforge.net/projects/plantuml/files/1.2019.13/plantuml.1.2019.13.jar/download'),
        ('1.2020.0', 'https://sourceforge.net/projects/plantuml/files/1.2020.0/plantuml.1.2020.0.jar/download'),
        ('1.2020.1', 'https://sourceforge.net/projects/plantuml/files/1.2020.1/plantuml.1.2020.1.jar/download'),
        ('1.2020.2', 'https://sourceforge.net/projects/plantuml/files/1.2020.2/plantuml.1.2020.2.jar/download'),
        ('1.2020.3', 'https://sourceforge.net/projects/plantuml/files/1.2020.3/plantuml.1.2020.3.jar/download'),
        ('1.2020.4', 'https://sourceforge.net/projects/plantuml/files/1.2020.4/plantuml.1.2020.4.jar/download'),
        ('1.2020.5', 'https://sourceforge.net/projects/plantuml/files/1.2020.5/plantuml.1.2020.5.jar/download'),
        ('1.2020.6', 'https://sourceforge.net/projects/plantuml/files/1.2020.6/plantuml.1.2020.6.jar/download'),
        ('1.2020.7', 'https://sourceforge.net/projects/plantuml/files/1.2020.7/plantuml.1.2020.7.jar/download'),
        ('1.2020.8', 'https://sourceforge.net/projects/plantuml/files/1.2020.8/plantuml.1.2020.8.jar/download'),
        ('1.2020.9', 'https://sourceforge.net/projects/plantuml/files/1.2020.9/plantuml.1.2020.9.jar/download'),
        ('1.2020.10', 'https://sourceforge.net/projects/plantuml/files/1.2020.10/plantuml.1.2020.10.jar/download'),
        ('1.2020.11', 'https://sourceforge.net/projects/plantuml/files/1.2020.11/plantuml.1.2020.11.jar/download'),
        ('1.2020.12', 'https://sourceforge.net/projects/plantuml/files/1.2020.12/plantuml.1.2020.12.jar/download'),
        ('1.2020.13', 'https://sourceforge.net/projects/plantuml/files/1.2020.13/plantuml.1.2020.13.jar/download'),
        ('1.2020.14', 'https://sourceforge.net/projects/plantuml/files/1.2020.14/plantuml.1.2020.14.jar/download'),
        ('1.2020.15', 'https://sourceforge.net/projects/plantuml/files/1.2020.15/plantuml.1.2020.15.jar/download'),
        ('1.2020.16', 'https://sourceforge.net/projects/plantuml/files/1.2020.16/plantuml.1.2020.16.jar/download'),
        ('1.2020.17', 'https://sourceforge.net/projects/plantuml/files/1.2020.17/plantuml.1.2020.17.jar/download'),
        ('1.2020.18', 'https://sourceforge.net/projects/plantuml/files/1.2020.18/plantuml.1.2020.18.jar/download'),
        ('1.2020.19', 'https://sourceforge.net/projects/plantuml/files/1.2020.19/plantuml.1.2020.19.jar/download'),
        ('1.2020.20', 'https://sourceforge.net/projects/plantuml/files/1.2020.20/plantuml.1.2020.20.jar/download'),
        ('1.2020.21', 'https://sourceforge.net/projects/plantuml/files/1.2020.21/plantuml.1.2020.21.jar/download'),
        ('1.2020.22', 'https://sourceforge.net/projects/plantuml/files/1.2020.22/plantuml.1.2020.22.jar/download'),
        ('1.2020.23', 'https://sourceforge.net/projects/plantuml/files/1.2020.23/plantuml.1.2020.23.jar/download'),
        ('1.2020.24', 'https://sourceforge.net/projects/plantuml/files/1.2020.24/plantuml.1.2020.24.jar/download'),
        ('1.2020.26', 'https://sourceforge.net/projects/plantuml/files/1.2020.26/plantuml.1.2020.26.jar/download'),
        ('1.2021.0', 'https://sourceforge.net/projects/plantuml/files/1.2021.0/plantuml.1.2021.0.jar/download'),
        ('1.2021.1', 'https://sourceforge.net/projects/plantuml/files/1.2021.1/plantuml.1.2021.1.jar/download'),
        ('1.2021.2', 'https://sourceforge.net/projects/plantuml/files/1.2021.2/plantuml.1.2021.2.jar/download'),
        ('1.2021.3', 'https://sourceforge.net/projects/plantuml/files/1.2021.3/plantuml.1.2021.3.jar/download'),
        ('1.2021.4', 'https://sourceforge.net/projects/plantuml/files/1.2021.4/plantuml.1.2021.4.jar/download'),
        ('1.2021.5', 'https://sourceforge.net/projects/plantuml/files/1.2021.5/plantuml.1.2021.5.jar/download'),
        ('1.2021.6', 'https://sourceforge.net/projects/plantuml/files/1.2021.6/plantuml.1.2021.6.jar/download'),
        ('1.2021.7', 'https://sourceforge.net/projects/plantuml/files/1.2021.7/plantuml.1.2021.7.jar/download'),
        ('1.2021.8', 'https://sourceforge.net/projects/plantuml/files/1.2021.8/plantuml.1.2021.8.jar/download'),
        ('1.2021.9', 'https://sourceforge.net/projects/plantuml/files/1.2021.9/plantuml.1.2021.9.jar/download'),
        ('1.2021.10', 'https://sourceforge.net/projects/plantuml/files/1.2021.10/plantuml.1.2021.10.jar/download'),
        ('1.2021.11', 'https://sourceforge.net/projects/plantuml/files/1.2021.11/plantuml.1.2021.11.jar/download'),
        ('1.2021.12', 'https://sourceforge.net/projects/plantuml/files/1.2021.12/plantuml.1.2021.12.jar/download'),
        ('1.2021.13', 'https://sourceforge.net/projects/plantuml/files/1.2021.13/plantuml.1.2021.13.jar/download'),
        ('1.2021.14', 'https://sourceforge.net/projects/plantuml/files/1.2021.14/plantuml.1.2021.14.jar/download'),
        ('1.2021.15', 'https://sourceforge.net/projects/plantuml/files/1.2021.15/plantuml.1.2021.15.jar/download'),
        ('1.2021.16', 'https://sourceforge.net/projects/plantuml/files/1.2021.16/plantuml.1.2021.16.jar/download'),
        ('1.2022.0', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.0/plantuml-1.2022.0.jar'),
        ('1.2022.1', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.1/plantuml-1.2022.1.jar'),
        ('1.2022.2', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.2/plantuml-1.2022.2.jar'),
        ('1.2022.3', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.3/plantuml-1.2022.3.jar'),
        ('1.2022.4', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.4/plantuml-1.2022.4.jar'),
        ('1.2022.5', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.5/plantuml-1.2022.5.jar'),
        ('1.2022.6', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.6/plantuml-1.2022.6.jar'),
        ('1.2022.7', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.7/plantuml-1.2022.7.jar'),
        ('1.2022.8', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.8/plantuml-1.2022.8.jar'),
        ('1.2022.9', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.9/plantuml-1.2022.9.jar'),
        ('1.2022.10', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.10/plantuml-1.2022.10.jar'),
        ('1.2022.11', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.11/plantuml-1.2022.11.jar'),
        ('1.2022.12', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.12/plantuml-1.2022.12.jar'),
        ('1.2022.13', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.13/plantuml-1.2022.13.jar'),
        ('1.2022.14', 'https://github.com/plantuml/plantuml/releases/download/v1.2022.14/plantuml-1.2022.14.jar'),
        ('1.2023.0', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.0/plantuml-1.2023.0.jar'),
        ('1.2023.1', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.1/plantuml-1.2023.1.jar'),
        ('1.2023.2', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.2/plantuml-1.2023.2.jar'),
        ('1.2023.3', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.3/plantuml-1.2023.3.jar'),
        ('1.2023.4', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.4/plantuml-1.2023.4.jar'),
        ('1.2023.5', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.5/plantuml-1.2023.5.jar'),
        ('1.2023.6', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.6/plantuml-1.2023.6.jar'),
        ('1.2023.7', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.7/plantuml-1.2023.7.jar'),
        ('1.2023.8', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.8/plantuml-1.2023.8.jar'),
        ('1.2023.9', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.9/plantuml-1.2023.9.jar'),
        ('1.2023.10', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.10/plantuml-1.2023.10.jar'),
        ('1.2023.11', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.11/plantuml-1.2023.11.jar'),
        ('1.2023.12', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.12/plantuml-1.2023.12.jar'),
        ('1.2023.13', 'https://github.com/plantuml/plantuml/releases/download/v1.2023.13/plantuml-1.2023.13.jar'),
        ('1.2024.0', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.0/plantuml-1.2024.0.jar'),
        ('1.2024.1', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.1/plantuml-1.2024.1.jar'),
        ('1.2024.2', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.2/plantuml-1.2024.2.jar'),
        ('1.2024.3', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.3/plantuml-1.2024.3.jar'),
        ('1.2024.4', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.4/plantuml-1.2024.4.jar'),
        ('1.2024.5', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.5/plantuml-1.2024.5.jar'),
        ('1.2024.6', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.6/plantuml-1.2024.6.jar'),
        ('1.2024.7', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.7/plantuml-1.2024.7.jar'),
        ('1.2024.8', 'https://github.com/plantuml/plantuml/releases/download/v1.2024.8/plantuml-1.2024.8.jar'),
        ('1.2025.0', 'https://github.com/plantuml/plantuml/releases/download/v1.2025.0/plantuml-1.2025.0.jar'),
        ('1.2025.1', 'https://github.com/plantuml/plantuml/releases/download/v1.2025.1/plantuml-1.2025.1.jar'),
        ('1.2025.2', 'https://github.com/plantuml/plantuml/releases/download/v1.2025.2/plantuml-1.2025.2.jar'),
        ('1.2025.3', 'https://github.com/plantuml/plantuml/releases/download/v1.2025.3/plantuml-1.2025.3.jar'),
        ('1.2030.0', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.0/plantuml-1.2030.0.jar'),
        ('1.2030.1', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.1/plantuml-1.2030.1.jar'),
        ('1.2030.2', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.2/plantuml-1.2030.2.jar'),
        ('1.2030.3', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.3/plantuml-1.2030.3.jar'),
        ('1.2030.4', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.4/plantuml-1.2030.4.jar'),
        ('1.2030.5', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.5/plantuml-1.2030.5.jar'),
        ('1.2030.6', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.6/plantuml-1.2030.6.jar'),
        ('1.2030.7', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.7/plantuml-1.2030.7.jar'),
        ('1.2030.8', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.8/plantuml-1.2030.8.jar'),
        ('1.2030.9', 'https://github.com/plantuml/plantuml/releases/download/v1.2030.9/plantuml-1.2030.9.jar'),
        ('1.2031.0', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.0/plantuml-1.2031.0.jar'),
        ('1.2031.1', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.1/plantuml-1.2031.1.jar'),
        ('1.2031.2', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.2/plantuml-1.2031.2.jar'),
        ('1.2031.3', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.3/plantuml-1.2031.3.jar'),
        ('1.2031.4', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.4/plantuml-1.2031.4.jar'),
        ('1.2031.5', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.5/plantuml-1.2031.5.jar'),
        ('1.2031.6', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.6/plantuml-1.2031.6.jar'),
        ('1.2031.7', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.7/plantuml-1.2031.7.jar'),
        ('1.2031.8', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.8/plantuml-1.2031.8.jar'),
        ('1.2031.9', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.9/plantuml-1.2031.9.jar'),
        ('1.2031.10', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.10/plantuml-1.2031.10.jar'),
        ('1.2031.11', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.11/plantuml-1.2031.11.jar'),
        ('1.2031.12', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.12/plantuml-1.2031.12.jar'),
        ('1.2031.13', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.13/plantuml-1.2031.13.jar'),
        ('1.2031.14', 'https://github.com/plantuml/plantuml/releases/download/v1.2031.14/plantuml-1.2031.14.jar'),
    ])
    def test_get_plantuml_jar_url(self, version, expected_url):
        assert get_plantuml_jar_url(version) == expected_url

    @pytest.mark.parametrize(['version', 'size', 'sha256'], [
        ('1.2017.19', 8572552, '4cdf08019ec3df8dedb30d629291ff164c376ca900f5b8c7d8fe0bd0d0e347cb'),
        ('1.2018.1', 7183577, '10a859bcf2f21c677d3c32d1cb70627529a0065fb7d766243a0a8a45cd320b27'),
        ('1.2018.4', 7235919, '72ee6194e5a22038e85f2f8249819d903ce658e1cbb332d6f0fcddaf5e907dd4'),
        ('1.2018.11', 7465678, 'd5260c45e0905127e3ce6707ccb85b873c16cf1adfaece74bf5eea6f7ebfcb00'),
        ('1.2020.4', 8395375, '8993ee0d82101f9db8e62b3015bd92cb2354ab496139096813bacebed70393d7'),
        ('1.2020.13', 8648228, 'f09b90d5b72f3fd85082c8445fcbf5f3b6a29dc24bb9ab6d157aaacca83780a5'),
        ('1.2021.5', 8544698, 'eaa46df314f8ec97e4f55736ee046f194f1936b8edf8964f93ca774091efb209'),
        ('1.2022.3', 10070645, 'cb92c5ca56321911f174ac49c7e6dbfda57cf0b27bca684fda69ecb979803465'),
        ('1.2023.10', 11565517, 'ee06454723028763dd8280459e8fd8f31fcd85b1ae8d9ab0e32122243c098c3b'),
        ('1.2025.3', 22384879, '837b7922fe30cac1336fd57c5aecc82f0a06032c77db949a6983a9a6ae41704a'),
    ])
    def test_get_plantuml_jar_file(self, version, size, sha256):
        file = get_plantuml_jar_file(version)
        assert os.path.getsize(file) == size
        assert _get_file_sha256(file) == sha256
